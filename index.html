<!DOCTYPE HTML>
<html>
  <head>
    <script src="jquery-2.1.4.min.js"></script>
    <script src="jquery.flot.js"></script>
    <script src="jquery.flot.symbol.js"></script>
    <script src="numeric-1.2.6.js"></script>
    <script src="numeric-pca.js"></script>
    <script src="data.js"></script>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div id="container">
      <div id="graph"></div>
      <p>PCA MBTI political affiliation.</p>
    </div>
<script>
var axis = ['EI', 'NS',  'FT', 'JP']

// step 1 : build dep/rep -> EI/NS/FT/JP matrix
function averagePreference(ax, party) {
  var avgs = []
  for (var i=0; i<2; i++) {
    var type = ax[i] // single letter
    var sum = 0
    for (var j=0 ; j<mbti_politics.length; j++) {
      if (mbti_politics[j].name.indexOf(type) >= 0) {
        sum += mbti_politics[j][party]
      }
    }
    avgs[i] = sum/8
  }
  return avgs[0] - avgs[1]
}

var m = [[],[]]
for (var i=0; i<axis.length; i++) {
  m[0][i] = averagePreference(axis[i], 'dem')
  m[1][i] = averagePreference(axis[i], 'rep')
}

console.log(m)

var evs = pca(m)
console.log(evs)

var graph = []

function projectPoint(p) {
  return [[
    evs[0][0] * p[0] + evs[0][1] * p[1] + evs[0][2] * p[2] + evs[0][3] * p[3],
    evs[1][0] * p[0] + evs[1][1] * p[1] + evs[1][2] * p[2] + evs[1][3] * p[3]
  ]]
}

// create points for all type
// example: INTJ = [-1,1,-1,1, <demOrRepValue>]
var points = {}
for (var i=0 ; i<mbti_politics.length; i++) {
  var name = mbti_politics[i].name
  for (var j=0; j<4; j++) {
    for (var k=0; k<2; k++) {
      var type = axis[j][k] // single letter
      if (name.indexOf(type) >= 0) {
        points[name] = points[name] || [] // create array if not yet created
        points[name][j] = 1 - k*2 // 0 -> 1 ; 1 -> -1
      }
    }
  }
  // value between [-1 ; 1]
  var diff = (mbti_politics[i].dem - mbti_politics[i].rep)/100
  points[name][4] = diff

  var pdata = projectPoint(points[name])
  //console.log(pdata)
  
  var label = name+' ('+diff+')'
  graph.push({ data: projectPoint(points[name]),
    points: { symbol: diff>0?"cross":"diamond" },
    mylabel: label
  })
  console.log(label)
}

console.log(points)

var p = $.plot("#graph", graph, {
  colors: ['#000'],
  series: {
	  points: { show: true, radius: 3 }
  },
  grid: {
    hoverable: true,
    markings: [
      { color: '#000', lineWidth: 1, xaxis: { from: 4.1, to: 4.1 } },
      { color: '#000', lineWidth: 1, yaxis: { from: 100, to: 100 } },
      { color: '#000', lineWidth: 1, yaxis: { from: 230, to: 230 } },
    ]
  },
  xaxis: { min: -3, max: 3 },
  yaxis: {
    min:-3,
    max:3,
    tickDecimals: 1
  }
});

$("#graph").bind("plothover", function(event, pos, item) {
  if (item) {
    console.log(item)
    console.log(''+item.series.mylabel)
  }
})
</script>
  </body>
</html>
      
